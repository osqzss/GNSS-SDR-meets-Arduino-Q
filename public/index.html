<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GNSS-SDR Live Monitor</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>

  <!-- Leaflet (OpenStreetMap) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <script>
    // Initial history length for plots
    window.INIT_MAX_POINTS = 300;
  </script>
</head>
<body>
  <header class="topbar">
    <div class="topbar-left">
      <h1>GNSS-SDR Live Monitor</h1>
      <div id="subtitle">
        <span id="ws-status" class="ws-bad">WebSocket: connecting…</span>
        <span class="sep">•</span>
        <span id="gnss-status">Status: unknown</span>
      </div>
    </div>

    <nav class="tabs" aria-label="Pages">
      <button class="tab" data-page="page-summary" id="tab-summary">Summary</button>
      <button class="tab" data-page="page-historics" id="tab-historics">Historics</button>
      <button class="tab" data-page="page-stats" id="tab-stats">Statistics</button>
      <button class="tab" data-page="page-observables" id="tab-observables">Observables</button>
    </nav>
  </header>

  <main class="pages">
    <!-- PAGE: SUMMARY -->
    <section class="page" id="page-summary" aria-labelledby="tab-summary">
      <div class="grid-summary">
        <div class="stack">
          <section class="card" id="gnss-control-card">
            <h2>GNSS-SDR Control</h2>
            <small>Start/stop local gnss-sdr process</small>
            <div class="gnss-control-row">
              <button id="btn-gnss-start">Replay Rocket launch</button>
              <button id="btn-gnss-start-2">Start GNSS-SDR (RTL Real-Time)</button>
              <button id="btn-gnss-start-3">Replay LEO Cubesat</button>
              <button id="btn-gnss-stop" class="stop">Stop</button>
            </div>
          </section>

          <section class="card" id="pvt-card">
            <h2>Position, Velocity, Time (PVT)</h2>
            <small id="pvt-age">No data yet</small>

            <div class="pvt-label">Geographic Coordinates</div>
            <div class="pvt-row">
              <div class="pvt-value" id="pvt-lat">Lat: –</div>
              <div class="pvt-value" id="pvt-lon">Lon: –</div>
              <div class="pvt-value" id="pvt-height">Alt: –</div>
            </div>

            <div class="pvt-label">Velocity ENU (m/s)</div>
            <div class="pvt-row">
              <div class="pvt-value" id="pvt-vel-e">E: –</div>
              <div class="pvt-value" id="pvt-vel-n">N: –</div>
              <div class="pvt-value" id="pvt-vel-u">U: –</div>
            </div>

            <div class="pvt-label">DOPs & Satellites</div>
            <div class="pvt-dops-row">
              <div class="pvt-value" id="pvt-dops">GDOP – PDOP – HDOP – VDOP –</div>
              <div class="pvt-value" id="pvt-sats">Sats: –</div>
            </div>

            <div class="pvt-label">Time</div>
            <div class="pvt-dops-row">
              <div class="pvt-value" id="pvt-weektow">Week –  TOW –</div>
              <div class="pvt-value" id="pvt-time-rx">UTC Time: –</div>
            </div>

            <div class="status-pill">
              <span class="status-dot" id="pvt-dot-bad"></span>
              <span id="pvt-sol-status">No solution</span>
            </div>
          </section>
        </div>

        <section class="card" id="map-card">
          <h2>Map (OpenStreetMap)</h2>
          <small>Current receiver position</small>
          <div id="map"></div>
        </section>
      </div>
    </section>

    <!-- PAGE: HISTORICS -->
    <section class="page" id="page-historics" aria-labelledby="tab-historics">
      <section class="card" id="plots-card">
        <h2>Time Series Plots</h2>
        <small>Fixed history: 3000 samples – Chart.js</small>

        <div id="decimation-container">
          <span>Decimation:</span>
          <select id="decimation-select">
            <option value="1">None</option>
            <option value="10">1 / 10</option>
            <option value="50">1 / 50</option>
          </select>
        </div>

        <div class="plot-wrapper">
          <div class="plot-title">Altitude [m]</div>
          <canvas id="alt-canvas"></canvas>
        </div>
        <div class="plot-wrapper">
          <div class="plot-title">C/N₀ [dB-Hz]</div>
          <canvas id="cn0-canvas"></canvas>
        </div>
        <div class="plot-wrapper">
          <div class="plot-title">Carrier Doppler [Hz]</div>
          <canvas id="dop-canvas"></canvas>
        </div>

        <div class="plot-wrapper">
          <div class="plot-title">Position LLA</div>
          <canvas id="pos-canvas"></canvas>
        </div>

        <div class="plot-wrapper">
          <div class="plot-title">Velocity ENU [m/s]</div>
          <canvas id="vel-canvas"></canvas>
        </div>
      </section>
    </section>

    <!-- PAGE: STATISTICS -->
    <section class="page" id="page-stats" aria-labelledby="tab-stats">
      <div class="stats-stack">
        <section class="card">
          <h2>Position Statistics</h2>
          <small id="stats-pos-count">Samples: 0</small>

          <div class="stats-grid">
            <div class="stat">
              <div class="stat-label">Lat mean (deg)</div>
              <div class="stat-value" id="stat-lat-mean">-</div>
            </div>
            <div class="stat">
              <div class="stat-label">Lon mean (deg)</div>
              <div class="stat-value" id="stat-lon-mean">-</div>
            </div>
            <div class="stat">
              <div class="stat-label">Alt mean (m)</div>
              <div class="stat-value" id="stat-alt-mean">-</div>
            </div>
          </div>

          <div class="hist-grid">
            <div class="hist-card">
              <div class="plot-title">Lat deviation</div>
              <canvas id="hist-lat-canvas"></canvas>
            </div>
            <div class="hist-card">
              <div class="plot-title">Lon deviation</div>
              <canvas id="hist-lon-canvas"></canvas>
            </div>
            <div class="hist-card">
              <div class="plot-title">Alt deviation</div>
              <canvas id="hist-alt-canvas"></canvas>
            </div>
          </div>
        </section>

        <section class="card">
          <h2>Velocity Statistics</h2>
          <small id="stats-vel-count">Samples: 0</small>

          <div class="stats-grid">
            <div class="stat">
              <div class="stat-label">Vel E mean (m/s)</div>
              <div class="stat-value" id="stat-vel-e-mean">-</div>
            </div>
            <div class="stat">
              <div class="stat-label">Vel N mean (m/s)</div>
              <div class="stat-value" id="stat-vel-n-mean">-</div>
            </div>
            <div class="stat">
              <div class="stat-label">Vel U mean (m/s)</div>
              <div class="stat-value" id="stat-vel-u-mean">-</div>
            </div>
          </div>

          <div class="hist-grid">
            <div class="hist-card">
              <div class="plot-title">Vel E deviation</div>
              <canvas id="hist-vel-e-canvas"></canvas>
            </div>
            <div class="hist-card">
              <div class="plot-title">Vel N deviation</div>
              <canvas id="hist-vel-n-canvas"></canvas>
            </div>
            <div class="hist-card">
              <div class="plot-title">Vel U deviation</div>
              <canvas id="hist-vel-u-canvas"></canvas>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- PAGE: OBSERVABLES -->
    <section class="page" id="page-observables" aria-labelledby="tab-observables">
      <section class="card">
        <h2>Tracking Channels</h2>
        <small>Status of all actively tracked channels</small>
        <div id="channels-container">
          <table>
            <thead>
              <tr>
                <th style="width:3rem;">CH</th>
                <th style="width:3.5rem;">PRN</th>
                <th style="width:3.5rem;">Sys</th>
                <th style="width:3.5rem;">Sig</th>
                <th style="width:4.5rem;" class="num">C/N₀</th>
                <th style="width:6rem;" class="num">Doppler</th>
                <th>Last update</th>
              </tr>
            </thead>
            <tbody id="channels-body"></tbody>
          </table>
        </div>
      </section>
    </section>
  </main>

  <div id="footer-log"></div>

  <!-- Client logic -->
  <script src="app.js"></script>
</body>
</html>
